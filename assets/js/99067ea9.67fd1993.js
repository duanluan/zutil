"use strict";(globalThis.webpackChunkzutil_docs=globalThis.webpackChunkzutil_docs||[]).push([[6869],{5395(e,l,n){n.d(l,{R:()=>c,x:()=>d});var t=n(7140);const r={},i=t.createContext(r);function c(e){const l=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(l):{...l,...e}},[l,e])}function d(e){let l;return l=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),t.createElement(i.Provider,{value:l},e.children)}},8203(e,l,n){n.r(l),n.d(l,{assets:()=>s,contentTitle:()=>d,default:()=>o,frontMatter:()=>c,metadata:()=>t,toc:()=>h});const t=JSON.parse('{"id":"reference-doc/thread/retryUtil","title":"RetryUtil \u91cd\u8bd5\u5de5\u5177","description":"\ud83d\udce6 \u5305\u8def\u5f84\uff1atop.csaf.thread.RetryUtil","source":"@site/docs/003-reference-doc/thread/retryUtil.md","sourceDirName":"003-reference-doc/thread","slug":"/reference-doc/thread/retryUtil","permalink":"/zutil/docs/reference-doc/thread/retryUtil","draft":false,"unlisted":false,"editUrl":"https://github.com/duanluan/zutil/tree/main/docs/docs/003-reference-doc/thread/retryUtil.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Thread \u7ebf\u7a0b\u5de5\u5177","permalink":"/zutil/docs/category/thread-\u7ebf\u7a0b\u5de5\u5177"},"next":{"title":"ThreadLocalUtil \u7ebf\u7a0b\u53d8\u91cf\u5de5\u5177","permalink":"/zutil/docs/reference-doc/thread/threadLocalUtil"}}');var r=n(5656),i=n(5395);const c={},d="RetryUtil \u91cd\u8bd5\u5de5\u5177",s={},h=[{value:"\u2728 \u6838\u5fc3\u7279\u6027",id:"-\u6838\u5fc3\u7279\u6027",level:2},{value:"\ud83d\ude80 \u5e38\u7528\u65b9\u6cd5\u6982\u89c8",id:"-\u5e38\u7528\u65b9\u6cd5\u6982\u89c8",level:2},{value:"1. \u914d\u7f6e\u65b9\u6cd5",id:"1-\u914d\u7f6e\u65b9\u6cd5",level:3},{value:"2. \u6267\u884c\u65b9\u6cd5",id:"2-\u6267\u884c\u65b9\u6cd5",level:3},{value:"\ud83e\uddea \u4f7f\u7528\u793a\u4f8b",id:"-\u4f7f\u7528\u793a\u4f8b",level:2},{value:"1. \u56fa\u5b9a\u95f4\u9694 + \u5f02\u5e38\u91cd\u8bd5",id:"1-\u56fa\u5b9a\u95f4\u9694--\u5f02\u5e38\u91cd\u8bd5",level:3},{value:"2. \u7ed3\u679c\u91cd\u8bd5\uff08\u8fd4\u56de\u503c\u4e0d\u6ee1\u8db3\u65f6\u91cd\u8bd5\uff09",id:"2-\u7ed3\u679c\u91cd\u8bd5\u8fd4\u56de\u503c\u4e0d\u6ee1\u8db3\u65f6\u91cd\u8bd5",level:3},{value:"3. \u7c7b\u578b\u5316\u7ed3\u679c\u8c13\u8bcd",id:"3-\u7c7b\u578b\u5316\u7ed3\u679c\u8c13\u8bcd",level:3},{value:"\u26a0\ufe0f \u5f02\u5e38\u4e0e\u4e2d\u65ad\u8bed\u4e49",id:"\ufe0f-\u5f02\u5e38\u4e0e\u4e2d\u65ad\u8bed\u4e49",level:2},{value:"1. \u4e2d\u65ad\u5f02\u5e38\u5904\u7406",id:"1-\u4e2d\u65ad\u5f02\u5e38\u5904\u7406",level:3},{value:"2. \u5f02\u5e38\u900f\u4f20\u4e0e\u5305\u88c5",id:"2-\u5f02\u5e38\u900f\u4f20\u4e0e\u5305\u88c5",level:3},{value:"\ud83d\udccf \u53c2\u6570\u7ea6\u675f",id:"-\u53c2\u6570\u7ea6\u675f",level:2}];function x(e){const l={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.header,{children:(0,r.jsx)(l.h1,{id:"retryutil-\u91cd\u8bd5\u5de5\u5177",children:"RetryUtil \u91cd\u8bd5\u5de5\u5177"})}),"\n",(0,r.jsxs)(l.blockquote,{children:["\n",(0,r.jsxs)(l.p,{children:["\ud83d\udce6 ",(0,r.jsx)(l.strong,{children:"\u5305\u8def\u5f84"}),"\uff1a",(0,r.jsx)(l.code,{children:"top.csaf.thread.RetryUtil"})]}),"\n",(0,r.jsxs)(l.p,{children:["\ud83d\udd17 ",(0,r.jsx)(l.strong,{children:"\u6240\u5c5e\u6a21\u5757"}),"\uff1a",(0,r.jsx)(l.code,{children:"zutil-all"})]}),"\n"]}),"\n",(0,r.jsxs)(l.p,{children:[(0,r.jsx)(l.code,{children:"RetryUtil"}),"\u662f\u57fa\u4e8e ",(0,r.jsx)(l.strong,{children:"Resilience4j Retry"})," \u7684\u8f7b\u91cf\u5c01\u88c5\uff0c\u63d0\u4f9b\u4e86\u7edf\u4e00\u7684\u91cd\u8bd5\u914d\u7f6e\u4e0e\u6267\u884c\u5165\u53e3\uff0c\u91cd\u70b9\u5904\u7406\u4e86\u4ee5\u4e0b\u95ee\u9898\uff1a"]}),"\n",(0,r.jsxs)(l.ul,{children:["\n",(0,r.jsx)(l.li,{children:"\u56fa\u5b9a\u95f4\u9694\u6216\u81ea\u5b9a\u4e49\u7b56\u7565\u91cd\u8bd5"}),"\n",(0,r.jsx)(l.li,{children:"\u5f02\u5e38\u91cd\u8bd5\u4e0e\u7ed3\u679c\u91cd\u8bd5"}),"\n",(0,r.jsxs)(l.li,{children:["\u7ebf\u7a0b\u4e2d\u65ad\u8bed\u4e49\u4fdd\u62a4\uff08",(0,r.jsx)(l.code,{children:"InterruptedException"}),"\u9ed8\u8ba4\u4e0d\u91cd\u8bd5\uff09"]}),"\n",(0,r.jsx)(l.li,{children:"\u53d7\u68c0\u5f02\u5e38\u5305\u88c5\u4e0e API \u7b80\u5316"}),"\n"]}),"\n",(0,r.jsx)(l.h2,{id:"-\u6838\u5fc3\u7279\u6027",children:"\u2728 \u6838\u5fc3\u7279\u6027"}),"\n",(0,r.jsxs)(l.ul,{children:["\n",(0,r.jsxs)(l.li,{children:["\u9ed8\u8ba4\u914d\u7f6e\u5b89\u5168\uff1a\u9ed8\u8ba4\u5ffd\u7565",(0,r.jsx)(l.code,{children:"InterruptedException"}),"\uff0c\u907f\u514d\u4e2d\u65ad\u88ab\u91cd\u590d\u91cd\u8bd5\u541e\u6389\u3002"]}),"\n",(0,r.jsxs)(l.li,{children:["\u7edf\u4e00\u6267\u884c\u5165\u53e3\uff1a\u652f\u6301",(0,r.jsx)(l.code,{children:"Callable"}),"\u3001",(0,r.jsx)(l.code,{children:"Supplier"}),"\u3001",(0,r.jsx)(l.code,{children:"Runnable"}),"\u3002"]}),"\n",(0,r.jsxs)(l.li,{children:["\u540d\u79f0\u89c4\u8303\u5316\uff1a\u7a7a\u767d\u540d\u79f0\u81ea\u52a8\u56de\u9000\u5230\u9ed8\u8ba4\u540d",(0,r.jsx)(l.code,{children:"RetryUtil"}),"\u3002"]}),"\n",(0,r.jsx)(l.li,{children:"\u6761\u4ef6\u5316\u91cd\u8bd5\uff1a\u652f\u6301\u6309\u5f02\u5e38\u7c7b\u578b\u3001\u7ed3\u679c\u503c\u3001\u95f4\u9694\u51fd\u6570\u7ec4\u5408\u7b56\u7565\u3002"}),"\n",(0,r.jsxs)(l.li,{children:["\u7c7b\u578b\u5316\u7ed3\u679c\u8c13\u8bcd\uff1a\u63d0\u4f9b",(0,r.jsx)(l.code,{children:"Class<T> + Predicate<? super T>"}),"\u91cd\u8f7d\uff0c\u907f\u514d\u7ed3\u679c\u7c7b\u578b\u4e0d\u5339\u914d\u65f6\u629b\u51fa\u8f6c\u6362\u5f02\u5e38\u3002"]}),"\n"]}),"\n",(0,r.jsx)(l.h2,{id:"-\u5e38\u7528\u65b9\u6cd5\u6982\u89c8",children:"\ud83d\ude80 \u5e38\u7528\u65b9\u6cd5\u6982\u89c8"}),"\n",(0,r.jsx)(l.h3,{id:"1-\u914d\u7f6e\u65b9\u6cd5",children:"1. \u914d\u7f6e\u65b9\u6cd5"}),"\n",(0,r.jsxs)(l.table,{children:[(0,r.jsx)(l.thead,{children:(0,r.jsxs)(l.tr,{children:[(0,r.jsx)(l.th,{style:{textAlign:"left"},children:"\u65b9\u6cd5"}),(0,r.jsx)(l.th,{style:{textAlign:"left"},children:"\u8bf4\u660e"})]})}),(0,r.jsxs)(l.tbody,{children:[(0,r.jsxs)(l.tr,{children:[(0,r.jsx)(l.td,{style:{textAlign:"left"},children:(0,r.jsx)(l.code,{children:"config(int maxAttempts, long waitMillis)"})}),(0,r.jsxs)(l.td,{style:{textAlign:"left"},children:["\u56fa\u5b9a\u95f4\u9694\u914d\u7f6e\u3002\u8981\u6c42",(0,r.jsx)(l.code,{children:"maxAttempts > 0"}),"\u3001",(0,r.jsx)(l.code,{children:"waitMillis >= 0"}),"\u3002"]})]}),(0,r.jsxs)(l.tr,{children:[(0,r.jsx)(l.td,{style:{textAlign:"left"},children:(0,r.jsx)(l.code,{children:"config(int, IntervalFunction, Predicate<Throwable>, Predicate<?>)"})}),(0,r.jsx)(l.td,{style:{textAlign:"left"},children:"\u81ea\u5b9a\u4e49\u95f4\u9694\u3001\u5f02\u5e38\u8c13\u8bcd\u3001\u7ed3\u679c\u8c13\u8bcd\u3002"})]}),(0,r.jsxs)(l.tr,{children:[(0,r.jsx)(l.td,{style:{textAlign:"left"},children:(0,r.jsx)(l.code,{children:"config(int, IntervalFunction, Predicate<Throwable>, Class<T>, Predicate<? super T>)"})}),(0,r.jsxs)(l.td,{style:{textAlign:"left"},children:["\u7c7b\u578b\u5316\u7ed3\u679c\u8c13\u8bcd\u914d\u7f6e\u3002",(0,r.jsx)(l.code,{children:"null"}),"\u7ed3\u679c\u56fa\u5b9a\u4e0d\u91cd\u8bd5\u3002"]})]})]})]}),"\n",(0,r.jsx)(l.h3,{id:"2-\u6267\u884c\u65b9\u6cd5",children:"2. \u6267\u884c\u65b9\u6cd5"}),"\n",(0,r.jsxs)(l.table,{children:[(0,r.jsx)(l.thead,{children:(0,r.jsxs)(l.tr,{children:[(0,r.jsx)(l.th,{style:{textAlign:"left"},children:"\u65b9\u6cd5"}),(0,r.jsx)(l.th,{style:{textAlign:"left"},children:"\u8bf4\u660e"})]})}),(0,r.jsxs)(l.tbody,{children:[(0,r.jsxs)(l.tr,{children:[(0,r.jsx)(l.td,{style:{textAlign:"left"},children:(0,r.jsx)(l.code,{children:"retry(String name, RetryConfig config)"})}),(0,r.jsxs)(l.td,{style:{textAlign:"left"},children:["\u521b\u5efa",(0,r.jsx)(l.code,{children:"Retry"}),"\u5b9e\u4f8b\uff1b",(0,r.jsx)(l.code,{children:"config == null"}),"\u65f6\u4f7f\u7528\u5185\u7f6e\u9ed8\u8ba4\u914d\u7f6e\u3002"]})]}),(0,r.jsxs)(l.tr,{children:[(0,r.jsx)(l.td,{style:{textAlign:"left"},children:(0,r.jsx)(l.code,{children:"execute(String name, RetryConfig config, Callable<T> callable)"})}),(0,r.jsx)(l.td,{style:{textAlign:"left"},children:"\u76f4\u63a5\u6309\u540d\u79f0+\u914d\u7f6e\u6267\u884c\u3002"})]}),(0,r.jsxs)(l.tr,{children:[(0,r.jsx)(l.td,{style:{textAlign:"left"},children:(0,r.jsx)(l.code,{children:"execute(Retry retry, Callable<T> callable)"})}),(0,r.jsxs)(l.td,{style:{textAlign:"left"},children:["\u6309",(0,r.jsx)(l.code,{children:"Retry"}),"\u5b9e\u4f8b\u6267\u884c\u3002"]})]}),(0,r.jsxs)(l.tr,{children:[(0,r.jsx)(l.td,{style:{textAlign:"left"},children:(0,r.jsx)(l.code,{children:"executeSupplier(Retry retry, Supplier<T> supplier)"})}),(0,r.jsx)(l.td,{style:{textAlign:"left"},children:"\u6267\u884c\u65e0\u53d7\u68c0\u5f02\u5e38\u4efb\u52a1\u3002"})]}),(0,r.jsxs)(l.tr,{children:[(0,r.jsx)(l.td,{style:{textAlign:"left"},children:(0,r.jsx)(l.code,{children:"run(Retry retry, Runnable runnable)"})}),(0,r.jsx)(l.td,{style:{textAlign:"left"},children:"\u6267\u884c\u65e0\u8fd4\u56de\u503c\u4efb\u52a1\u3002"})]})]})]}),"\n",(0,r.jsx)(l.h2,{id:"-\u4f7f\u7528\u793a\u4f8b",children:"\ud83e\uddea \u4f7f\u7528\u793a\u4f8b"}),"\n",(0,r.jsx)(l.h3,{id:"1-\u56fa\u5b9a\u95f4\u9694--\u5f02\u5e38\u91cd\u8bd5",children:"1. \u56fa\u5b9a\u95f4\u9694 + \u5f02\u5e38\u91cd\u8bd5"}),"\n",(0,r.jsx)(l.pre,{children:(0,r.jsx)(l.code,{className:"language-java",children:'RetryConfig config = RetryUtil.config(3, 200L);\nRetry retry = RetryUtil.retry("http-call", config);\n\nString result = RetryUtil.execute(retry, () -> {\n  // \u524d\u4e24\u6b21\u629b\u5f02\u5e38\uff0c\u7b2c\u4e09\u6b21\u6210\u529f\n  return remoteCall();\n});\n'})}),"\n",(0,r.jsx)(l.h3,{id:"2-\u7ed3\u679c\u91cd\u8bd5\u8fd4\u56de\u503c\u4e0d\u6ee1\u8db3\u65f6\u91cd\u8bd5",children:"2. \u7ed3\u679c\u91cd\u8bd5\uff08\u8fd4\u56de\u503c\u4e0d\u6ee1\u8db3\u65f6\u91cd\u8bd5\uff09"}),"\n",(0,r.jsx)(l.pre,{children:(0,r.jsx)(l.code,{className:"language-java",children:'IntervalFunction interval = attempt -> 100L;\nRetryConfig config = RetryUtil.config(\n  3,\n  interval,\n  null,\n  result -> result == null\n);\n\nString value = RetryUtil.execute(RetryUtil.retry("result-retry", config), () -> fetchMaybeNull());\n'})}),"\n",(0,r.jsx)(l.h3,{id:"3-\u7c7b\u578b\u5316\u7ed3\u679c\u8c13\u8bcd",children:"3. \u7c7b\u578b\u5316\u7ed3\u679c\u8c13\u8bcd"}),"\n",(0,r.jsx)(l.pre,{children:(0,r.jsx)(l.code,{className:"language-java",children:'IntervalFunction interval = attempt -> 0L;\nRetryConfig config = RetryUtil.config(\n  3,\n  interval,\n  null,\n  String.class,\n  String::isEmpty\n);\n\nString value = RetryUtil.execute(RetryUtil.retry("typed", config), () -> "");\n'})}),"\n",(0,r.jsx)(l.p,{children:"\u884c\u4e3a\u8bf4\u660e\uff1a"}),"\n",(0,r.jsxs)(l.ul,{children:["\n",(0,r.jsxs)(l.li,{children:["\u8fd4\u56de\u503c\u662f",(0,r.jsx)(l.code,{children:"String"}),"\u4e14\u6ee1\u8db3",(0,r.jsx)(l.code,{children:"String::isEmpty"}),"\u65f6\u4f1a\u91cd\u8bd5"]}),"\n",(0,r.jsxs)(l.li,{children:["\u8fd4\u56de\u503c\u7c7b\u578b\u4e0d\u5339\u914d\u65f6\u4e0d\u4f1a\u91cd\u8bd5\uff08\u4e0d\u4f1a\u629b",(0,r.jsx)(l.code,{children:"ClassCastException"}),"\uff09"]}),"\n",(0,r.jsxs)(l.li,{children:["\u8fd4\u56de\u503c\u4e3a",(0,r.jsx)(l.code,{children:"null"}),"\u65f6\u4e0d\u4f1a\u91cd\u8bd5"]}),"\n"]}),"\n",(0,r.jsx)(l.h2,{id:"\ufe0f-\u5f02\u5e38\u4e0e\u4e2d\u65ad\u8bed\u4e49",children:"\u26a0\ufe0f \u5f02\u5e38\u4e0e\u4e2d\u65ad\u8bed\u4e49"}),"\n",(0,r.jsx)(l.h3,{id:"1-\u4e2d\u65ad\u5f02\u5e38\u5904\u7406",children:"1. \u4e2d\u65ad\u5f02\u5e38\u5904\u7406"}),"\n",(0,r.jsxs)(l.ul,{children:["\n",(0,r.jsxs)(l.li,{children:["\u9ed8\u8ba4\u914d\u7f6e\u5df2\u5ffd\u7565",(0,r.jsx)(l.code,{children:"InterruptedException"}),"\u91cd\u8bd5"]}),"\n",(0,r.jsxs)(l.li,{children:["\u6267\u884c\u5c42\u6355\u83b7",(0,r.jsx)(l.code,{children:"InterruptedException"}),"\u540e\u4f1a\u8c03\u7528",(0,r.jsx)(l.code,{children:"Thread.currentThread().interrupt()"}),"\u6062\u590d\u4e2d\u65ad\u6807\u8bb0\uff0c\u518d\u629b\u51fa",(0,r.jsx)(l.code,{children:"RuntimeException"})]}),"\n"]}),"\n",(0,r.jsx)(l.h3,{id:"2-\u5f02\u5e38\u900f\u4f20\u4e0e\u5305\u88c5",children:"2. \u5f02\u5e38\u900f\u4f20\u4e0e\u5305\u88c5"}),"\n",(0,r.jsxs)(l.ul,{children:["\n",(0,r.jsx)(l.li,{children:"\u8fd0\u884c\u65f6\u5f02\u5e38\uff1a\u4fdd\u6301\u539f\u5f02\u5e38\u7c7b\u578b\u5411\u5916\u629b\u51fa"}),"\n",(0,r.jsxs)(l.li,{children:["\u53d7\u68c0\u5f02\u5e38\uff1a\u5305\u88c5\u4e3a",(0,r.jsx)(l.code,{children:"RuntimeException"}),"\uff08",(0,r.jsx)(l.code,{children:"cause"}),"\u4fdd\u7559\u539f\u59cb\u5f02\u5e38\uff09"]}),"\n"]}),"\n",(0,r.jsx)(l.h2,{id:"-\u53c2\u6570\u7ea6\u675f",children:"\ud83d\udccf \u53c2\u6570\u7ea6\u675f"}),"\n",(0,r.jsxs)(l.p,{children:["-",(0,r.jsx)(l.code,{children:"maxAttempts"}),"\u5fc5\u987b\u5927\u4e8e",(0,r.jsx)(l.code,{children:"0"}),"\n-",(0,r.jsx)(l.code,{children:"waitMillis"}),"\u5fc5\u987b\u5927\u4e8e\u7b49\u4e8e",(0,r.jsx)(l.code,{children:"0"})]}),"\n",(0,r.jsxs)(l.ul,{children:["\n",(0,r.jsxs)(l.li,{children:["\u81ea\u5b9a\u4e49\u914d\u7f6e\u65f6",(0,r.jsx)(l.code,{children:"intervalFunction"}),"\u4e0d\u80fd\u4e3a\u7a7a"]}),"\n",(0,r.jsxs)(l.li,{children:["\u7c7b\u578b\u5316\u91cd\u8f7d\u4e2d\uff1a\u5f53",(0,r.jsx)(l.code,{children:"retryOnResult != null"}),"\u65f6\uff0c",(0,r.jsx)(l.code,{children:"resultType"}),"\u4e0d\u80fd\u4e3a\u7a7a"]}),"\n"]})]})}function o(e={}){const{wrapper:l}={...(0,i.R)(),...e.components};return l?(0,r.jsx)(l,{...e,children:(0,r.jsx)(x,{...e})}):x(e)}}}]);